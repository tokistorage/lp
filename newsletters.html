<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" sizes="32x32" href="asset/favicon-32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="asset/apple-touch-icon.png">
    <title>ニュースレター | トキストレージ</title>
    <meta name="description" content="トキストレージ ニュースレター一覧。国立国会図書館法に基づき納本される逐次刊行物。声を国家の永久保存記録にする活動の記録。">    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="contact-form.css">
    <style>
        .newsletters-page {
            max-width: 1100px;
            margin: 0 auto;
            padding: 2rem;
            padding-top: 6rem;
        }

        .newsletters-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .newsletters-header h1 {
            font-family: 'Hiragino Mincho ProN', 'Yu Mincho', serif;
            font-size: 2.2rem;
            color: #1e293b;
            margin-bottom: 1rem;
        }

        .newsletters-header .lead {
            font-size: 1.1rem;
            color: #64748b;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.8;
        }

        /* Publication metadata */
        .pub-meta {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 3rem;
        }

        .pub-meta h2 {
            font-family: 'Hiragino Mincho ProN', 'Yu Mincho', serif;
            font-size: 1.3rem;
            color: #1e293b;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .pub-meta h2::before {
            content: '';
            width: 4px;
            height: 1.5rem;
            background: #2563EB;
            border-radius: 2px;
        }

        .meta-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }

        .meta-item {
            display: flex;
            gap: 0.75rem;
        }

        .meta-label {
            font-size: 0.8rem;
            color: #94a3b8;
            min-width: 5rem;
            flex-shrink: 0;
        }

        .meta-value {
            font-size: 0.9rem;
            color: #1e293b;
        }

        /* Numbering info */
        .numbering-info {
            background: #eff6ff;
            border-left: 4px solid #2563EB;
            border-radius: 0 8px 8px 0;
            padding: 1rem 1.5rem;
            margin-top: 1.5rem;
            font-size: 0.85rem;
            color: #475569;
            line-height: 1.8;
        }

        /* Section */
        .newsletters-section {
            margin-bottom: 4rem;
        }

        .newsletters-section h2 {
            font-family: 'Hiragino Mincho ProN', 'Yu Mincho', serif;
            font-size: 1.5rem;
            color: #1e293b;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .newsletters-section h2::before {
            content: '';
            width: 4px;
            height: 1.5rem;
            background: #2563EB;
            border-radius: 2px;
        }

        /* Card grid */
        .newsletter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
        }

        .newsletter-card {
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: inherit;
            cursor: pointer;
        }

        .newsletter-card:hover {
            border-color: #2563EB;
            box-shadow: 0 4px 20px rgba(37, 99, 235, 0.1);
        }

        .card-vol {
            font-size: 0.75rem;
            color: #2563EB;
            font-weight: 600;
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
        }

        .card-date {
            font-size: 0.8rem;
            color: #94a3b8;
            margin-bottom: 0.75rem;
        }

        .newsletter-card h3 {
            font-family: 'Hiragino Mincho ProN', 'Yu Mincho', serif;
            font-size: 1.15rem;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .newsletter-card p {
            font-size: 0.9rem;
            color: #64748b;
            line-height: 1.7;
            flex: 1;
        }

        .card-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            align-items: center;
        }

        .card-read {
            color: #2563EB;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .card-read::after {
            content: '\2192';
        }

        .card-pdf {
            font-size: 0.8rem;
            color: #94a3b8;
            text-decoration: none;
            padding: 0.2rem 0.6rem;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .card-pdf:hover {
            color: #2563EB;
            border-color: #2563EB;
        }

        /* Footer nav */
        /* Special Feature Series */
        .series-section {
            margin-bottom: 4rem;
        }

        .series-section h2 {
            font-family: 'Hiragino Mincho ProN', 'Yu Mincho', serif;
            font-size: 1.5rem;
            color: #1e293b;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .series-section h2::before {
            content: '';
            width: 4px;
            height: 1.5rem;
            background: #C9A962;
            border-radius: 2px;
        }

        .series-lead {
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 1.5rem;
            line-height: 1.7;
        }

        .series-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .series-card {
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 1.5rem;
            text-decoration: none;
            color: inherit;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
        }

        .series-card:hover {
            border-color: #C9A962;
            box-shadow: 0 4px 20px rgba(201, 169, 98, 0.1);
        }

        .series-card.preparing {
            opacity: 0.6;
            cursor: default;
        }

        .series-card.preparing:hover {
            border-color: #e2e8f0;
            box-shadow: none;
        }

        .series-card h3 {
            font-family: 'Hiragino Mincho ProN', 'Yu Mincho', serif;
            font-size: 1.05rem;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .series-card .series-meta {
            font-size: 0.8rem;
            color: #94a3b8;
            margin-top: auto;
            padding-top: 0.75rem;
        }

        .series-empty {
            color: #94a3b8;
            font-size: 0.9rem;
            text-align: center;
            padding: 2rem;
        }

        .series-nav {
            margin-bottom: 1.5rem;
        }

        .series-nav-default {
            margin-bottom: 0.75rem;
        }

        .series-nav-century {
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            margin-bottom: 0.75rem;
            background: #fafbfc;
        }

        .series-nav-century summary {
            font-family: 'Hiragino Mincho ProN', 'Yu Mincho', serif;
            font-size: 0.95rem;
            font-weight: 600;
            color: #1e293b;
            padding: 0.7rem 1rem;
            cursor: pointer;
            list-style: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .series-nav-century summary::-webkit-details-marker { display: none; }

        .series-nav-century summary::before {
            content: '▸';
            font-size: 0.75rem;
            color: #C9A962;
            transition: transform 0.15s;
        }

        .series-nav-century[open] summary::before {
            transform: rotate(90deg);
        }

        .series-nav-century-count {
            font-size: 0.75rem;
            font-weight: 400;
            color: #94a3b8;
        }

        .series-nav-century-inner {
            padding: 0 0.5rem 0.5rem 1rem;
        }

        .series-nav-vol {
            border: 1px solid #e8ecf0;
            border-radius: 6px;
            margin-bottom: 0.4rem;
            background: #fff;
        }

        .series-nav-vol summary {
            font-size: 0.82rem;
            font-weight: 600;
            color: #475569;
            padding: 0.45rem 0.8rem;
            cursor: pointer;
            list-style: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .series-nav-vol summary::-webkit-details-marker { display: none; }

        .series-nav-vol summary::before {
            content: '▸';
            font-size: 0.6rem;
            color: #94a3b8;
            transition: transform 0.15s;
        }

        .series-nav-vol[open] summary::before {
            transform: rotate(90deg);
        }

        .series-nav-vol-count {
            font-size: 0.72rem;
            font-weight: 400;
            color: #94a3b8;
        }

        .series-nav-years {
            display: flex;
            flex-wrap: wrap;
            gap: 0.3rem;
            padding: 0 0.8rem 0.5rem 1.5rem;
        }

        .series-nav-link {
            font-size: 0.78rem;
            color: #64748b;
            text-decoration: none;
            padding: 0.2rem 0.6rem;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.15s;
            background: #fff;
        }

        .series-nav-link:hover {
            color: #C9A962;
            border-color: #C9A962;
        }

        .series-nav-link.active {
            background: #C9A962;
            color: #fff;
            border-color: #C9A962;
        }

        .series-view-label {
            font-size: 0.85rem;
            color: #64748b;
            margin-bottom: 1rem;
        }

        .newsletters-footer {
            text-align: center;
            padding: 3rem 0;
            border-top: 1px solid #e2e8f0;
        }

        .newsletters-footer a {
            color: #2563EB;
            text-decoration: none;
            margin: 0 1rem;
            font-size: 0.9rem;
        }

        .newsletters-footer a:hover {
            text-decoration: underline;
        }

        .newsletters-footer p {
            font-size: 0.8rem;
            color: #94a3b8;
            margin-top: 1.5rem;
        }

        .newsletter-status {
            display: inline-block;
            font-size: 0.72rem;
            font-weight: 600;
            letter-spacing: 0.05em;
            padding: 0.2rem 0.7rem;
            border-radius: 2rem;
            margin-bottom: 0.5rem;
        }
        .newsletter-status.published { background: #2563EB; color: #fff; }
        .newsletter-status.drafting { background: #FFF3E0; color: #E65100; }

        @media (max-width: 768px) {
            .newsletters-page { padding-top: 5rem; }
            .newsletters-header h1 { font-size: 1.8rem; }
            .meta-grid { grid-template-columns: 1fr; }
        }
    </style>
    <meta property="og:type" content="article">
    <meta property="og:title" content="ニュースレター | トキストレージ">
    <meta property="og:description" content="トキストレージ ニュースレター一覧。国立国会図書館法に基づき納本される逐次刊行物。声を国家の永久保存記録にする活動の記録。">
    <meta property="og:url" content="https://tokistorage.github.io/lp/newsletters.html">
    <meta property="og:site_name" content="トキストレージ">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="ニュースレター | トキストレージ">
    <meta name="twitter:description" content="トキストレージ ニュースレター一覧。国立国会図書館法に基づき納本される逐次刊行物。声を国家の永久保存記録にする活動の記録。">
    <meta property="og:image" content="https://tokistorage.github.io/lp/asset/tokistorage-icon-512.png">
    <meta property="og:image:width" content="512">
    <meta property="og:image:height" content="512">
    <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "ニュースレター | トキストレージ",
  "url": "https://tokistorage.github.io/lp/newsletters.html",
  "inLanguage": "ja",
  "publisher": {
    "@type": "Organization",
    "name": "TokiStorage",
    "url": "https://tokistorage.github.io/lp"
  },
  "description": "トキストレージ ニュースレター一覧。国立国会図書館法に基づき納本される逐次刊行物。声を国家の永久保存記録にする活動の記録。"
}
    </script>
    <link rel="alternate" hreflang="ja" href="https://tokistorage.github.io/lp/newsletters.html">
    <link rel="alternate" hreflang="en" href="https://tokistorage.github.io/lp/newsletters-en.html">
    <link rel="alternate" hreflang="x-default" href="https://tokistorage.github.io/lp/newsletters.html">
    <link rel="canonical" href="https://tokistorage.github.io/lp/newsletters.html">
</head>
<body>

<nav class="toki-nav">
    <a href="index.html" class="nav-logo">トキストレージ</a>
    <div class="nav-links">
        <a href="index.html#how">仕組み</a>
        <a href="index.html#pricing">料金</a>
        <a href="details.html">詳しく知る</a>
        <a href="newsletters-en.html" class="lang-switch" aria-label="Switch to English">EN</a>
    </div>
    <button class="nav-toggle" aria-label="メニュー">
        <span></span><span></span><span></span>
    </button>
</nav>

<div class="newsletters-page">

    <header class="newsletters-header">
        <h1>ニュースレター</h1>
        <p class="lead">国立国会図書館に納本される逐次刊行物。<br>声を国家の永久保存記録にする活動の記録です。</p>
    </header>

    <!-- Publication Metadata -->
    <section class="pub-meta">
        <h2>刊行情報</h2>
        <div class="meta-grid">
            <div class="meta-item">
                <span class="meta-label">刊行物名</span>
                <span class="meta-value">トキストレージ ニュースレター</span>
            </div>
            <div class="meta-item">
                <span class="meta-label">英題</span>
                <span class="meta-value">TokiStorage Newsletter</span>
            </div>
            <div class="meta-item">
                <span class="meta-label">発行者</span>
                <span class="meta-value">TokiStorage（佐藤卓也）</span>
            </div>
            <div class="meta-item">
                <span class="meta-label">刊行頻度</span>
                <span class="meta-value">不定期（年複数回）</span>
            </div>
            <div class="meta-item">
                <span class="meta-label">納本先</span>
                <span class="meta-value">国立国会図書館</span>
            </div>
            <div class="meta-item">
                <span class="meta-label">フォーマット</span>
                <span class="meta-value">PDF（電子書籍等）</span>
            </div>
            <div class="meta-item">
                <span class="meta-label">根拠法</span>
                <span class="meta-value">国立国会図書館法 第25条・第25条の4</span>
            </div>
            <div class="meta-item">
                <span class="meta-label">創刊</span>
                <span class="meta-value">2026年2月（令和8年）</span>
            </div>
            <div class="meta-item">
                <span class="meta-label">納本状況</span>
                <span class="meta-value">収集対象確認済・定期自動収集（受付番号 EA202602160140）</span>
            </div>
        </div>
        <div class="numbering-info">
            <strong>採番体系（式年遷宮型）：</strong>1巻＝20年周期（第1巻＝2026–2045年）。号（Number）＝巻内の通し番号（遷宮ごとにリセット）。通巻（Serial）＝全巻通し番号（5桁）。ファイル名はYYYY-MM形式（発行月）。1000年で50巻。
        </div>
    </section>

    <!-- Back-Number Grid -->
    <section class="newsletters-section">
        <h2>バックナンバー</h2>
        <div id="backnumber-nav"></div>
        <div class="series-view-label" id="backnumber-view-label"></div>
        <div class="newsletter-grid" id="backnumber-list"></div>
    </section>

    <!-- Special Feature Series -->
    <section class="series-section" id="special-features">
        <h2>別冊特集シリーズ</h2>
        <p class="series-lead">
            TokiQR特集権を購入されたお客様ごとに開設される別冊特集ニュースレター。<br>
            各シリーズは独立した逐次刊行物として国立国会図書館に納本されます。
        </p>
        <div id="series-nav"></div>
        <div class="series-view-label" id="series-view-label"></div>
        <div class="series-grid" id="series-list">
            <p class="series-empty">現在開設されている別冊特集シリーズはありません。</p>
        </div>
    </section>

    <footer class="newsletters-footer">
        <p style="font-family: Georgia, 'Times New Roman', serif; font-size: 0.8rem; color: #94A3B8; font-style: italic; margin-bottom: 0.8rem;">あなたが物語となり、世代の対話が重なり、未来の道となる。</p>
        <p>&copy; 2026 TokiStorage. All rights reserved.</p>
    </footer>

</div>

<script>
// Shared constants
var VOLUME_YEARS = 20;
var START_YEAR = 2026;
function getVolume(year) { return Math.floor((year - START_YEAR) / VOLUME_YEARS) + 1; }
function volPeriod(vol) { var s = START_YEAR + (vol - 1) * VOLUME_YEARS; return s + '–' + (s + VOLUME_YEARS - 1); }
function getCentury(year) { return Math.floor(year / 100) + 1; }
function centuryRange(c) { return ((c - 1) * 100) + '–' + (c * 100 - 1); }

function buildCenturyNav(items, getItemYear, navEl, opts) {
  var yearSet = {};
  items.forEach(function(s) { yearSet[getItemYear(s)] = true; });
  var years = Object.keys(yearSet).map(Number).sort();

  var volMap = {};
  years.forEach(function(y) {
    var v = getVolume(y);
    if (!volMap[v]) volMap[v] = [];
    volMap[v].push(y);
  });

  var vols = Object.keys(volMap).map(Number).sort();
  var centuryMap = {};
  vols.forEach(function(v) {
    var startY = START_YEAR + (v - 1) * VOLUME_YEARS;
    var c = getCentury(startY);
    if (!centuryMap[c]) centuryMap[c] = [];
    centuryMap[c].push(v);
  });

  var centuries = Object.keys(centuryMap).map(Number).sort();
  var latestCentury = centuries[centuries.length - 1];
  var latestVol = vols[vols.length - 1];

  var navHtml = '<div class="series-nav-default">'
    + '<span class="series-nav-link active" data-id="default">' + (opts.defaultLabel || '最新') + '</span></div>';

  centuries.forEach(function(c) {
    var volsInC = centuryMap[c];
    var countInC = items.filter(function(s) {
      return volsInC.some(function(v) { return volMap[v].indexOf(getItemYear(s)) >= 0; });
    }).length;
    var isLatestC = c === latestCentury;

    navHtml += '<details class="series-nav-century"' + (isLatestC ? ' open' : '') + '>'
      + '<summary>第' + c + '世紀（' + centuryRange(c) + '）'
      + '<span class="series-nav-century-count">' + countInC + '件</span></summary>'
      + '<div class="series-nav-century-inner">';

    volsInC.forEach(function(v) {
      var seriesInVol = items.filter(function(s) {
        return volMap[v].indexOf(getItemYear(s)) >= 0;
      }).length;
      var isLatestV = v === latestVol;

      navHtml += '<details class="series-nav-vol"' + (isLatestV ? ' open' : '') + '>'
        + '<summary>第' + v + '巻（' + volPeriod(v) + '）'
        + '<span class="series-nav-vol-count">' + seriesInVol + '件</span></summary>'
        + '<div class="series-nav-years">';
      volMap[v].forEach(function(y) {
        var countInYear = items.filter(function(s) { return getItemYear(s) === y; }).length;
        navHtml += '<span class="series-nav-link" data-id="y-' + y + '">'
          + y + '（' + countInYear + '）</span>';
      });
      navHtml += '</div></details>';
    });

    navHtml += '</div></details>';
  });

  navEl.innerHTML = navHtml;
  return { volMap: volMap, centuryMap: centuryMap };
}

// ── Back-Numbers ──
(async function() {
  try {
    var res = await fetch('newsletter/schedule.json');
    if (!res.ok) return;
    var schedule = await res.json();
    var issues = schedule.issues || [];
    if (issues.length === 0) return;

    issues.sort(function(a, b) { return b.date.localeCompare(a.date); });

    var currentYear = new Date().getFullYear();
    function issueYear(i) { return parseInt(i.date.slice(0, 4)); }

    var statusLabel = { published: '発行済み', drafting: '推敲中' };
    var statusClass = { published: 'published', drafting: 'drafting' };

    var navEl = document.getElementById('backnumber-nav');
    var labelEl = document.getElementById('backnumber-view-label');
    var listEl = document.getElementById('backnumber-list');

    function renderIssues(list) {
      if (list.length === 0) {
        listEl.innerHTML = '<p class="series-empty">該当する号はありません。</p>';
        return;
      }
      listEl.innerHTML = list.map(function(i) {
        var serial5 = String(i.serial).padStart(5, '0');
        var href = i.page_url || '#';
        var html = '<a href="' + href + '" class="newsletter-card">'
          + '<div class="card-vol">VOL.' + i.volume + ' NO.' + i.number + ' — SERIAL #' + serial5 + '</div>'
          + '<span class="newsletter-status ' + (statusClass[i.status] || '') + '">' + (statusLabel[i.status] || i.status) + '</span>'
          + '<div class="card-date">' + i.date.replace('-', '年') + '月</div>'
          + '<h3>' + (i.title_ja || '第' + i.serial + '号') + '</h3>'
          + '<div class="card-actions"><span class="card-read">詳しく読む</span>';
        if (i.status === 'published' && i.pdf_url) {
          html += '<span class="card-pdf" onclick="event.preventDefault();event.stopPropagation();window.location.href=\'' + i.pdf_url + '\';">PDF</span>';
        }
        html += '</div></a>';
        return html;
      }).join('');
    }

    function showDefault() {
      var latest = issues.slice(0, 10);
      var thisYear = issues.filter(function(i) { return issueYear(i) === currentYear; });
      var seen = {};
      var merged = [];
      latest.concat(thisYear).forEach(function(i) {
        if (!seen[i.serial]) { seen[i.serial] = true; merged.push(i); }
      });
      merged.sort(function(a, b) { return b.date.localeCompare(a.date); });
      labelEl.textContent = '最新（' + merged.length + '件）';
      renderIssues(merged);
      setActive('default');
    }

    function showYear(year) {
      var filtered = issues.filter(function(i) { return issueYear(i) === year; });
      labelEl.textContent = year + '年（' + filtered.length + '件）';
      renderIssues(filtered);
      setActive('y-' + year);
    }

    function setActive(id) {
      navEl.querySelectorAll('.series-nav-link').forEach(function(el) {
        el.classList.toggle('active', el.getAttribute('data-id') === id);
      });
    }

    buildCenturyNav(issues, issueYear, navEl, { defaultLabel: '最新' });

    navEl.addEventListener('click', function(e) {
      var link = e.target.closest('.series-nav-link');
      if (!link) return;
      var id = link.getAttribute('data-id');
      if (id === 'default') showDefault();
      else if (id.startsWith('y-')) showYear(parseInt(id.slice(2)));
    });

    showDefault();
  } catch (e) {}
})();

// ── Special Feature Series ──
(async function() {
  try {
    var res = await fetch('newsletter/series-registry.json');
    if (!res.ok) return;
    var data = await res.json();
    var all = (data.series || []).filter(function(s) { return s.status !== 'inactive'; });
    if (all.length === 0) return;

    all.sort(function(a, b) { return b.createdAt.localeCompare(a.createdAt); });

    var currentYear = new Date().getFullYear();
    function getYear(s) { return parseInt(s.createdAt.slice(0, 4)); }

    var container = document.getElementById('series-list');
    var navEl = document.getElementById('series-nav');
    var labelEl = document.getElementById('series-view-label');

    function renderCards(list) {
      if (list.length === 0) {
        container.innerHTML = '<p class="series-empty">該当するシリーズはありません。</p>';
        return;
      }
      container.innerHTML = list.map(function(s) {
        if (s.issueCount) {
          return '<a href="' + s.pagesUrl + '" class="series-card" target="_blank" rel="noopener">'
            + '<h3>' + s.seriesName + ' 特集</h3>'
            + '<span class="series-meta">'
            + s.issueCount + '号発行'
            + (s.createdAt ? ' / 開設 ' + s.createdAt : '')
            + '</span></a>';
        }
        return '<div class="series-card preparing">'
          + '<h3>' + s.seriesName + ' 特集</h3>'
          + '<span class="series-meta">準備中'
          + (s.createdAt ? ' / 開設 ' + s.createdAt : '')
          + '</span></div>';
      }).join('');
    }

    function showDefault() {
      var latest = all.slice(0, 10);
      var thisYear = all.filter(function(s) { return getYear(s) === currentYear; });
      var seen = {};
      var merged = [];
      latest.concat(thisYear).forEach(function(s) {
        var key = s.seriesName + s.createdAt;
        if (!seen[key]) { seen[key] = true; merged.push(s); }
      });
      labelEl.textContent = '最新（' + merged.length + '件）';
      renderCards(merged);
      setActive('default');
    }

    function showYear(year) {
      var filtered = all.filter(function(s) { return getYear(s) === year; });
      labelEl.textContent = year + '年（' + filtered.length + '件）';
      renderCards(filtered);
      setActive('y-' + year);
    }

    function setActive(id) {
      navEl.querySelectorAll('.series-nav-link').forEach(function(el) {
        el.classList.toggle('active', el.getAttribute('data-id') === id);
      });
    }

    buildCenturyNav(all, getYear, navEl, { defaultLabel: '最新' });

    navEl.addEventListener('click', function(e) {
      var link = e.target.closest('.series-nav-link');
      if (!link) return;
      var id = link.getAttribute('data-id');
      if (id === 'default') showDefault();
      else if (id.startsWith('y-')) showYear(parseInt(id.slice(2)));
    });

    showDefault();
  } catch (e) {}
})();
</script>
<script src="index.js" defer></script>
<script src="contact-form.js" defer></script>
<script src="tracker.js" defer></script>
</body>
</html>
